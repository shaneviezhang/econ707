---
title: "X Variables"
subtitle: "Week 10"
author: "Alex Cardazzi"
institute: "Old Dominion University"
format:
  revealjs:
    # chalkboard: true

    echo: true
    code-fold: show
    code-summary: "Code"
    code-tools: true
    code-copy: hover
    link-external-newwindow: true
    tbl-cap-location: top
    fig-cap-location: bottom
    #smaller: true
    
    scrollable: true
    incremental: true 
    slide-number: c/t
    show-slide-number: all
    menu: false
    
    logo: "https://ww1.odu.edu/facultystaff/communication/toolkit/current-logos/_jcr_content/par/section_1593932067/columns_527553970/column_2/image.img.440.jpg/1599596551953.jpg"
    footer: "ECON 707/807: Econometrics II"
  
self-contained: true
# embed-resources: true
# standalone: true

editor: source
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.align = 'center')
knitr::opts_chunk$set(out.width = '90%')

par(mar = c(4.1, 4.1, 1.1, 4.1))
set.seed(321)
library("stargazer")
library("lubridate")
library("forecast")
library("scales")
library("tseries")
```

## Topics

- Exam 2
- Spurious Regression
- Cointegration

# Exam 2

## X predicts Y

Thus far, we have only used past $Y$ values to forecast future $Y$ values.

- Of course, other things (besides $e$) can effect $Y$

. . .

In forecasting, we call these *leading indicators*

- Example: housing starts, building permits, Starbucks (?)

## Yield Curve

Interest rates denote the risk of an assets.

- higher rates $\implies$ greater risk

. . .

Yield Curve

- Length on the X axis, Yield on the Y axis.
- Should be an upward slope.

. . .

An *inverted* curve has correctly predicted the past 7 recessions.

## {background-color="black" background-image="../yield_curve.png" background-size="contain"}

## Yield Curve

<center>
<iframe src="https://fred.stlouisfed.org/graph/graph-landing.php?g=VtrH&width=width=960&height=500" scrolling="no" frameborder="0" style="width:960px; height:500px;" allowTransparency="true" loading="lazy" data-external="1"></iframe>
</center>

## Yield Curve {visibility="uncounted"}

<center>
<iframe src="https://fred.stlouisfed.org/graph/graph-landing.php?g=Vtti&width=width=960&height=500" scrolling="no" frameborder="0" style="width:960px; height:500px;" allowTransparency="true" loading="lazy" data-external="1"></iframe>
</center>

<!-- ## AIDS Diagnoses -->

<!-- aids diagnoses here ... -->

## Regressing Y on X

$$\% \Delta PCE_t = f(\% \Delta \text{Income}_t, \% \Delta \text{Savings}_t, \Delta \text{U-Rate}_t) + e_t$$

```{r}
#| code-fold: true
macro <- read.csv("../data/macro.csv")
macro$DATE <- ymd(macro$DATE)
```

## Regressing Y on X {visibility="uncounted"}

```{r}
#| output-location: slide
#| code-fold: show
macrots <- ts(macro, start = c(min(year(macro$DATE)), 1, 1))
acf(macrots[,2:4])
```

## Regressing Y on X {visibility="uncounted"}

To forecast using this type of model, you will need "future" values of your explanatory variables.

- This is easy for some thing, and difficult for other
- Vector Autoregression (VAR)
- Impulse Response Functions (IRF)

## Regressing Y on X {visibility="uncounted"}

OK, so estimate $Y_t = f(X_t, e_t)$!

. . . 

$$\Delta GDP_t = \alpha + \beta \Delta GDP_{t-1} + \gamma \text{Spread}_{t-1} + e_t$$

. . .

But first ... what about stationarity?



<!-- ## Unit Root Diagnostics -->

<!-- ::: {.dtList} -->

<!-- 1. Examine (plot) your data -->
<!--     - Is there a trend?  Constant variance? Seasonality? -->
<!-- 1. ADF Test -->
<!--     - If non-stationary, difference. -->

<!-- ::: -->

## Spurious Regression

Suppose you have two independent time series $y_t$ and $x_t$.

- If you regress $y_t$ on $x_t$ ($y_t = \alpha + \beta x_t + e_t$), what should $\hat{\beta}$ be?

## Spurious Regression {visibility="uncounted"}

```{r}
#| code-fold: true
tz <- c()

for(j in 1:1000){
  
  x <- rnorm(120)
  y <- rnorm(120)
  
  tz[j] <- summary(lm(y ~ x))$coefficients[2,3]
}

plot(table(round(tz, 1)),
     ylab = "Frequency",
     xlab = paste0(round(100*mean(abs(tz) > 1.96)),
                   "% Significant"))
abline(v = 0, col = "tomato")
```

## Spurious Regression {visibility="uncounted"}

```{r}
#| code-fold: true
for(j in 1:1000){
  
  x <- rep(0, 120)
  y <- rep(0, 120)
  
  for(i in 2:120){
    
    x[i] <- x[i-1] + rnorm(1)
    y[i] <- y[i-1] + rnorm(1)
  }
  
  tz[j] <- summary(lm(y ~ x))$coefficients[2,3]
}

plot(table(round(tz, 0)),
     ylab = "Frequency",
     xlab = paste0(round(100*mean(abs(tz) > 1.96)),
                   "% Significant"))
abline(v = 0, col = "tomato")
```

## Spurious Regression {visibility="uncounted"}

This happens when you regress two random walks on one another.

```{r}
#| code-fold: true
par(mfrow = c(1, 2))
plot(x, type = "l", col = alpha("tomato", .6),
     xlab = "Time", ylab = "",
     ylim = range(x, y))
lines(y, col = alpha("dodgerblue", .6))
plot(x, y, pch = 19, col = alpha("black", .6),
     xlab = "X", ylab = "Y")
abline(lm(y ~ x), lty = 2)
```

## Spurious Regression {visibility="uncounted"}

```{r results='asis'}
#| code-fold: true
reg1 <- lm(y ~ x)
t <- 2:length(y)
reg2 <- lm(y[t] ~ x[t] + y[t-1])
stargazer(reg1, reg2, type = "html")
```

## Spurious Regression {visibility="uncounted"}

Warnings:

::: {.dtList}
1. Check stationarity of the residuals
    - Regression is spurious if residuals have a unit root.
    - ```tseries::adf.test(lm(y ~ x)$residuals)```
1. Results change dramatically if lagged $y$ is included
1. If spurious, make stationary!
:::

## Spurious Regression {visibility="uncounted"}

```{r results='hold'}
#| code-fold: true
adf.test(reg1$residuals)
adf.test(reg2$residuals)
```

## Integration

Time series with unit roots are said to be integrated or $I(1)$

- $I(1)$ is unit root
- $I(0)$ is stationary
- $I(d)$ is $d$'th difference stationary
    - Hansen says $I(2)$ series are price levels and money supply

## Money Supply {visibility="uncounted"}

<center>
<iframe src="https://fred.stlouisfed.org/graph/graph-landing.php?g=VtwN&width=width=960&height=500" scrolling="no" frameborder="0" style="width:960px; height:500px;" allowTransparency="true" loading="lazy" data-external="1"></iframe>
</center>

## Money Supply {visibility="uncounted"}

<center>
<iframe src="https://fred.stlouisfed.org/graph/graph-landing.php?g=VtwX&width=width=960&height=500" scrolling="no" frameborder="0" style="width:960px; height:500px;" allowTransparency="true" loading="lazy" data-external="1"></iframe>
</center>

## Cointegration

Two series are *cointegrated* if a linear combination of them has a lower level of integration.

- If $Y$ and $X$ are $I(1)$, but $Y - \theta X$ is $I(0)$, they are cointegrated.
- Also consider two proportional time series.
    - If $\frac{Y}{X}$ is stationary, then $log(Y) - \theta log(X)$ is $I(0)$

. . .

Another way to think about it: two series are cointegrated if there is a (relatively) constant distance between the two.

## Cointegration {visibility="uncounted"}

<table border="0" width="100%">
  <tbody><tr>
    <td width="50%"><p align="center"><img src="https://www.eco.uc3m.es/~jgonzalo/teaching/econometriaii/archivos_cointegration/oldladyRandomWalk.gif" alt="oldladyRandomWalk.gif (14623 bytes)" width="40" height="110">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p></td>
    <td width="50%"><p align="center"><img src="https://www.eco.uc3m.es/~jgonzalo/teaching/econometriaii/archivos_cointegration/boy_randomWalk.gif" alt="boy_randomWalk.gif (976 bytes)" width="47" height="85"></p></td>
  </tr>
  <tr>
    <td width="100%" colspan="2"><p align="center"><img src="https://www.eco.uc3m.es/~jgonzalo/teaching/econometriaii/archivos_cointegration/oldman_dog.gif" width="168" height="128" alt="oldman_dog.gif (11472 bytes)"></p></td>
  </tr>
</tbody></table>

::: aside
eco.uc3m.es/~jgonzalo/teaching/econometriaii/cointegration.htm
:::

<!-- ## Cointegration -->

<!-- ```{r} -->
<!-- #| code-fold: true -->
<!-- n <- 120 -->
<!-- y <- rep(0,n) -->
<!-- x <- rep(0,n) -->

<!-- set.seed(321) -->
<!-- for (i in 2:n) { -->
<!--   x[i] = x[i-1] + rnorm(1) -->
<!--   y[i] = 4*x[i] + rnorm(1) -->
<!-- } -->
<!-- x1 <- x; y1 <- y -->
<!-- plot(x, ylim = range(x, y), -->
<!--      xlab = "Time", ylab = "", -->
<!--      type = "l", col = "tomato", -->
<!--      main = "Y = 4X + e") -->
<!-- lines(y, col = "dodgerblue") -->
<!-- ``` -->

<!-- ## Cointegration -->

<!-- ```{r} -->
<!-- #| code-fold: true -->
<!-- plot(y - (4*x), -->
<!--      xlab = "Time", ylab = "Y - 4X", -->
<!--      type = "l", col = "black") -->
<!-- ``` -->

## Cointegration {visibility="uncounted"}

Again, $y$ and $x$ are coinegrated if:

$$z_t = y_t - \theta x_t \ \ \text{is} \ \ I(0)$$

. . .

$\theta$ is sometimes known from theory

- In the case of term spread, it is $1$.
- This can also be estimated.

## Cointegration {visibility="uncounted"}

<center>
<iframe src="https://fred.stlouisfed.org/graph/graph-landing.php?g=Vv1f&width=width=960&height=500" scrolling="no" frameborder="0" style="width:960px; height:500px;" allowTransparency="true" loading="lazy" data-external="1"></iframe>
</center>

## Cointegration {visibility="uncounted"}

```{r}
#| code-fold: true

pi <- read.csv("../data/inc_pce.csv")
pi$DATE <- ymd(pi$DATE)
par(mfrow = c(1, 2))
plot(pi$DATE, pi$PI, type = "l",
     ylim = range(pi$PI, pi$PCE),
     xlab = "Date", ylab = "log($)",
     col = "tomato")
lines(pi$DATE, pi$PCE, type = "l", col = "dodgerblue")
legend("topleft", legend = c("PI", "PCE"),
       col = c("tomato", "dodgerblue"),
       lty = 1, bty = "n")

plot(pi$DATE, log(pi$PI), type = "l",
     ylim = log(range(pi$PI, pi$PCE)),
     xlab = "Date", ylab = "log($)",
     col = "tomato")
lines(pi$DATE, log(pi$PCE), type = "l", col = "dodgerblue")
legend("topleft", legend = c("PI", "PCE"),
       col = c("tomato", "dodgerblue"),
       lty = 1, bty = "n")

```

## Cointegration {visibility="uncounted"}

```{r}
#| code-fold: true
reg <- lm(log(PCE) ~ log(PI), data = pi)
summary(reg)
```

## Cointegration {visibility="uncounted"}

```{r}
#| code-fold: true
plot(pi$DATE,
     reg$residuals,
     type = "l")
```

## Cointegration {visibility="uncounted"}

```{r}
#| code-fold: true
tseries::adf.test(reg$residuals)
```

## Cointegration {visibility="uncounted"}

<center>
<iframe src="https://fred.stlouisfed.org/graph/graph-landing.php?g=VvcW&width=width=960&height=500" scrolling="no" frameborder="0" style="width:960px; height:500px;" allowTransparency="true" loading="lazy" data-external="1"></iframe>
</center>

## Cointegration {visibility="uncounted"}

Does the comovement of the 10-Year and 3-Month indicate a spurious relationship or cointegration?

- They are both certainly non-stationary.

## Cointegration {visibility="uncounted"}

```{r}
#| code-fold: true
fred <- read.csv("../data/spread.csv")
fred$DATE <- ymd(fred$DATE)
fred <- fred[fred$DGS10 != ".",]
fred <- fred[fred$DATE < ymd("2014-05-01"),]
colnames(fred) <- c("DATE", "t3m", "spread", "t120m")

for(i in 2:4) fred[,i] <- as.numeric(fred[,i])

reg <- lm(t120m ~ t3m, data = fred)
summary(reg)
```

## Cointegration {visibility="uncounted"}


The residuals from this regression are $z_t$!

```{r}
plot(fred$DATE, reg$residuals, type = "l",
     xlab = "", ylab = "")
```

## Cointegration {visibility="uncounted"}

```{r}
#| code-fold: true
tseries::adf.test(reg$residuals)
```

<!-- ## Cointegration {visibility="uncounted"} -->

<!-- ```{r} -->
<!-- #| code-fold: true -->
<!-- par(mfrow = c(1, 2)) -->
<!-- acf(reg$residuals); pacf(reg$residuals) -->
<!-- ``` -->

<!-- ## Cointegration -->

<!-- ```{r} -->
<!-- #| code-fold: true -->
<!-- y <- ts(reg$residuals, start = c(1982, 1, 1), frequency = 12) -->
<!-- auto.arima(y) -->
<!-- ``` -->



## Cointegration {visibility="uncounted"}

What does this have to do with spurious regression?

- Stationary: use raw series
- Non-Stationary: use differenced series
- Non-Stationary \& Cointegrated: use differenced series $+$ *error correction*

## Cointegration

Error Correction Model: the change of one series is explained in terms of:

- the lag of the difference between the series
- lags of the differences of each series

. . .

$$\begin{align}\Delta y_t &= \Sigma_{i = 1}^{p} \alpha_{i} \Delta y_{t-i} \\ &+ \Sigma_{j = 1}^{q} \beta_{j} \Delta x_{t-j} \\ &+ \gamma z_{t-1} + \mu + e_t\end{align}$$

## Cointegration {visibility="uncounted"}

$z_t$ is the residual from the $Y$ on $X$ regression.

. . .

$$Y_t = \alpha + \beta X_t + z_t$$

. . .

If $z_t$ is stationary, then $Y$ and $X$ are cointegrated.

<!-- ## Cointegration -->

<!-- ```{r} -->
<!-- #| code-fold: true -->
<!-- n <- 120 -->
<!-- y <- rep(0,n) -->
<!-- x <- rep(0,n) -->

<!-- set.seed(321) -->
<!-- for (i in 2:n) { -->
<!--   x[i] = x[i-1] + rnorm(1) -->
<!--   y[i] = 4*x[i] + rnorm(1) -->
<!-- } -->
<!-- # x <- x1; y <- y1 -->
<!-- plot(x, ylim = range(x, y), -->
<!--      xlab = "Time", ylab = "", -->
<!--      type = "l", col = "tomato", -->
<!--      main = "Y = 4X + e") -->
<!-- lines(y, col = "dodgerblue") -->
<!-- ``` -->

<!-- ## Cointegration -->

<!-- ```{r} -->
<!-- #| code-fold: true -->
<!-- reg <- lm(y ~ x) -->
<!-- resid <- reg$residuals[3:length(y)] -->
<!-- dx <- diff(x) -->
<!-- dy <- diff(y) -->

<!-- t <- 2:length(dx) -->
<!-- dxlag <- dx[t-1]; dx <- dx[t] -->
<!-- dylag <- dy[t-1]; dy <- dy[t] -->

<!-- summary(lm(dy ~ dylag + dxlag + resid)) -->
<!-- ``` -->

## Cointegration {visibility="uncounted"}

<!-- The 10-year rate decreases when long rate exceeds the short rate. -->

```{r}
#| code-fold: true
t <- 2:nrow(fred)
d_t3m <- fred$t3m[t] - fred$t3m[t-1]
d_t120m <- fred$t120m[t] - fred$t120m[t-1]

t <- 2:length(d_t3m)
d_t3m_lag <- d_t3m[t-1]
d_t120m_lag <- d_t120m[t-1]
d_t3m <- d_t3m[t]
d_t120m <- d_t120m[t]

resid <- reg$residuals[2:(nrow(fred)-1)]
summary(lm(d_t120m ~ d_t120m_lag + d_t3m_lag + resid))
```






<!-- - http://www.fsb.miamioh.edu/lij14/672_2014_s8.pdf -->


<!-- - could also be that Y/X is proportional over time ... -->
<!-- 	  - log(Y) - log(X) -->
<!-- - should use granger's eq (22, slide 12) -->
<!-- 	  - \delta T3_t = \alpha \delta T3_{t-1} + \beta \delta T120_{t-1} + \gamma spread_{t-1} -->
<!-- 		    - what if you don't know coefficient for \theta? -->
<!-- 		    - can estimate it -->



